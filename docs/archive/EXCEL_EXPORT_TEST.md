# Excel 匯出功能測試指南

## 問題診斷

Excel 匯出功能已經修復並添加了詳細的錯誤處理和 debug 訊息。

## 已完成的修復

1. ✅ 添加了完整的 try-catch 錯誤處理
2. ✅ 添加了詳細的 console.log 調試訊息
3. ✅ 檢查 XLSX 套件是否正確載入
4. ✅ 檢查案件資料是否存在
5. ✅ 添加了日期格式錯誤處理
6. ✅ 更新了 Next.js 配置以支援 Turbopack

## 測試步驟

### 1. 打開瀏覽器

訪問: <http://localhost:3001/cases>

### 2. 打開開發者工具

按 F12 或右鍵 → 檢查 → Console 標籤

### 3. 點擊匯出按鈕

點擊頁面右上角的「📊 匯出 Excel」按鈕

### 4. 查看 Console 輸出

**正常情況下應該看到:**

```
🚀 開始匯出 Excel...
📊 案件數量: X
📦 XLSX 套件: object
🔄 開始轉換資料...
✅ 資料轉換完成,共 X 筆
📄 建立工作表...
📚 建立工作簿...
💾 準備下載: 案件清單_YYYYMMDD_HHmm.xlsx
✅ Excel 匯出成功!
```

**如果出現錯誤,會看到:**

```
❌ Excel 匯出失敗: [錯誤訊息]
```

同時會彈出 alert 對話框顯示錯誤詳情。

### 5. 檢查下載

如果成功,應該會自動下載一個 Excel 檔案,檔名格式為:
`案件清單_YYYYMMDD_HHmm.xlsx`

## 可能的錯誤情況

### 錯誤 1: XLSX 套件未載入

**訊息:** `❌ XLSX 套件未載入!`
**解決方法:**

```bash
cd my-case-tracker
yarn install
yarn dev
```

### 錯誤 2: 沒有案件資料

**訊息:** `⚠️ 沒有案件資料可匯出`
**解決方法:** 確保資料庫中有案件資料,或檢查篩選條件

### 錯誤 3: 日期格式錯誤

**訊息:** `日期格式錯誤: [日期值]`
**影響:** 該日期欄位會顯示為空,但不影響整體匯出

## 匯出的 Excel 內容

匯出的 Excel 檔案包含以下欄位:

1. 案號
2. 買方
3. 賣方
4. 區域
5. 狀態
6. 總價(萬)
7. 買方貸款
8. 賣方代償
9. 稅單性質
10. 預收規費(萬)
11. 簽約日
12. 用印日
13. 完稅日
14. 過戶日
15. 交屋日
16. 過戶備註
17. 未完成待辦
18. 備註
19. 警示

## 技術細節

### 修改的檔案

1. **src/components/ExportExcelButton.tsx**
   - 添加完整的錯誤處理
   - 添加詳細的 debug 訊息
   - 改善日期格式處理

2. **next.config.ts**
   - 添加 `turbopack: {}` 配置
   - 避免 webpack 配置衝突

### 依賴套件

- `xlsx@0.18.5` - Excel 檔案生成
- `date-fns@4.1.0` - 日期格式化

## 如果問題仍然存在

請提供以下資訊:

1. Console 的完整錯誤訊息
2. 瀏覽器版本
3. 是否有任何網路錯誤 (Network 標籤)
4. 案件資料數量

## Git Commit

建議的 commit 訊息:

```
fix(export): 修復 Excel 匯出功能並添加詳細錯誤處理

- 添加 try-catch 錯誤處理機制
- 添加詳細的 console.log 調試訊息
- 檢查 XLSX 套件載入狀態
- 改善日期格式錯誤處理
- 更新 Next.js 配置支援 Turbopack
- 添加使用者友善的錯誤提示
```
