-- 1. Create contract_clauses table
CREATE TABLE IF NOT EXISTS contract_clauses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    category TEXT DEFAULT '一般',
    tags TEXT[],
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    last_updated_by UUID REFERENCES auth.users(id)
);

-- 2. Enable RLS
ALTER TABLE contract_clauses ENABLE ROW LEVEL SECURITY;

-- 3. Policy: Allow all authenticated users
DROP POLICY IF EXISTS "Allow all authenticated users to full access clauses" ON contract_clauses;
CREATE POLICY "Allow all authenticated users to full access clauses" ON contract_clauses
    FOR ALL TO authenticated
    USING (true)
    WITH CHECK (true);

-- 4. Trigger for updated_at (ensure function exists)
CREATE OR REPLACE FUNCTION update_modified_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

DROP TRIGGER IF EXISTS update_contract_clauses_modtime ON contract_clauses;
CREATE TRIGGER update_contract_clauses_modtime
    BEFORE UPDATE ON contract_clauses
    FOR EACH ROW
    EXECUTE FUNCTION update_modified_column();

-- 5. Import Data (54 records)
INSERT INTO contract_clauses (title, content, category) VALUES
('借車位使用', '買賣雙方協議，買方於用印款匯入後，賣方同意無條件將本案車位予買方使用，車位管理費由交付鑰匙日分算。若因車位保管不當所造成之任何損害皆由買方自行負責。', '一般'),
('交屋時未遷戶籍', '茲因乙方未能於交屋前將設籍於本標的之全戶戶籍（含分戶）遷離，今甲、乙雙方同意，乙方最遲應於民國114年   月    日前將全戶戶籍（含分戶）遷離，惟乙方如未於約定期限內完成上述事項，甲方得逕自向戶政機關申請逕遷，若有因此損及甲方權益，則乙方應負損害賠償責任。', '一般'),
('鑑界', '甲、乙雙方確已知悉，本案為一樓建物，永慶房屋於簽約前已詳盡告知甲方相關權益及風險，並建議於用印前向地政機關申請鑑界確認有無佔用、被佔用情事，經甲方審慎評估思考後表達不須申請並願依現況承購，日後雙方不得再就上述情事，向他方、永慶房屋及其受僱人為任何之請求。', '一般'),
('貸款成數解約-買方需配合', '甲、乙雙方確認，本標的物於用印前若經甲方及代書申貸金融機構確認無法核貸成交總價7成之貸款者，除甲方同意於用印前完成補足款項外，甲乙雙方同意不經催告即無條件解除買賣契約，乙方應同時返還甲方既付款項。甲方應配合申貸金融機構提供相關財力證明，若不願配合故意、刻意延遲申貸金融機構提供財力證明以致本案貸款無法核貸，甲方視同違約。', '一般'),
('無違章', '本案謄本其他登記事項登載:（一般註記事項）嗣後建築物所有權人於因買賣、交換、贈與、信託辦理所有權移轉登記時，得檢附開業建築師出具 三個月內有效之建築物無違章建築證明。甲乙雙方合意，甲方依現況承受，乙方不須開立無違章建築證明。', '一般'),
('無車位分管', '乙方表達本案車位固定位置使用，惟無法提供車位分管協議、住戶規約或建商原始之停車位買賣契約書予甲方，永慶房屋仲介股份有限公司已告知甲方相關權益風險，甲方同意由乙方依無法提供上開資料之現況移轉，日後買賣雙方不得因此原因向永慶房屋仲介股份有限公司及承辦人員要求減少價金、損害賠償或解除買賣契約等。', '一般'),
('買方不具貸款資格', '甲、乙雙方確認，本標的物若經甲方及代書申貸金融機構確認甲方不具貸款資格致無法核貸者，除甲方同意於完稅款前完成補足款項外，甲乙雙方同意不經催告即無條件解除買賣契約，乙方應同時返還甲方既付款項。甲方應配合申貸金融機構提供相關財力證明，若不願配合故意、刻意延遲申貸金融機構提供財力證明以致本案貸款無法核貸，甲方視同違約。', '一般'),
('約定專用', '本買賣標的物依地政機關登記之謄本為準，其現況：約定專用部分，雙方及永慶房屋對該約定專用部分之範圍及使用權利均不負擔保之責，買方應於簽約前自行查明確認，日後若有糾紛，由買方自行處理，與賣方及永慶房屋無涉，買方並不得據此請求解除契約或減少價金。', '一般'),
('出租', '本買賣標的物現況出租予第三人，賣方（即出租人）承諾於民國114年月日租期屆滿，由賣方負責排除租賃關係（如與承租人協議終止租約或搬遷事宜），並依買賣契約約定騰空點交予買方，若屆時無法依約騰空，即視為賣方違約，應負遲延責任。', '一般'),
('出租', '本買賣標的物現況出租予第三人，賣方（即出租人）承諾於交屋前負責排除租賃關係（如與承租人協議終止租約或搬遷事宜），並依買賣契約約定騰空點交予買方，若屆時無法依約騰空，即視為賣方違約，應負遲延責任。', '一般'),
('漏水修繕', '有關本標的物現況主建物天花板有油漆剝落及壁癌之瑕疵，買方同意自行修繕，賣方不負瑕疵擔保責任。', '一般'),
('不負過戶前滲漏水保固之責', '買賣雙方確認，本標的物賣方依現況交屋，買方同意自行修繕，並免除賣方滲漏水瑕疵擔保責任（含交屋前、後發生之滲漏水情事）。', '一般'),
('不負滲漏水保固之責', '買賣雙方確認，本標的物賣方依現況交屋，買方同意自行修繕，並免除賣方滲漏水瑕疵擔保責任（含交屋前、後發生之滲漏水情事），惟買方應於交屋後半年內完成修繕，逾期未修繕或修繕不完全所生之損害，概由買方自行負責，與賣方無涉。', '一般'),
('貸款成數', '買賣雙方同意，本案簽立買賣契約後，買方若無法貸得新台幣0萬元整（成交總價八成），除不可歸責於買方之因素外，買方應於稅單核發前以現金一次補足差額，否則視為買方違約，買方絕無異議。惟若因政策因素（如央行限縮貸款成數、貸款資格限制等）致無法核貸上開金額時，買方得於稅單核發前以現金一次補足差額，或經賣方同意解除買賣契約，賣方應無息返還買方已付之款項，雙方互不負違約責任。', '一般'),
('貸款成數', '本件買賣契約第三期款（完稅款）約定新台幣0萬元整，雙方同意包含所有權移轉登記所需之增值稅、契稅等相關稅費，並同意由承辦代書於完稅款中代為繳納；若有餘額，雙方同意轉為第四期款（交屋款）之一部分；若有不足，買方應於完稅款同時補足。', '一般'),
('貸款不足現金補足', '買賣雙方同意，本案若因個人信用因素或房屋本身條件致銀行核貸金額不足時，買方應於完稅款前以現金一次補足差額。', '一般'),
('土地增值稅', '本案買賣價格不含土地增值稅，土地增值稅由賣方負擔。', '一般'),
('土地增值稅', '本案買賣價格已含土地增值稅，土地增值稅由賣方負擔。', '一般'),
('土地增值稅', '本案買賣價格不含土地增值稅，土地增值稅由買方負擔（即實拿）。', '一般'),
('仲介費', '本案買賣總價包含賣方應給付永慶房屋仲介服務費，賣方實拿新台幣0萬元整。', '一般'),
('仲介費', '本案買賣總價不包含賣方應給付永慶房屋仲介服務費，賣方應另行給付永慶房屋仲介服務費。', '一般'),
('優先購買權', '本案標的物如有共有人或基地承租人主張優先購買權時，本買賣契約當然無效，賣方應無息退還買方已付之價金，雙方互不負違約責任。', '一般'),
('所有權移轉', '本案產權移轉登記，買賣雙方同意指定由永慶房屋特約地政士辦理，並同意相關稅費及代書費依約定負擔。', '一般'),
('其他', '買方購買本標的物係供自用住宅使用，若日後發現本標的物有非自然身故（如凶宅）之情事，買方得解除契約，賣方應退還已收價金並賠償買方因此所受之損害。', '一般'),
('其他', '本標的物附贈設備：詳如現況說明書或附贈設備清單。', '一般'),
('其他', '本約簽訂後，如因政策變動或法令修改致影響本約之履行時，雙方應誠信協商解決之道，不得歸責於任一方。', '一般'),
('停車位', '本買賣標的物含停車位乙個（編號：0號，位置：地下0層），型式為平面式/機械式。', '一般'),
('停車位', '本買賣標的物不含停車位。', '一般'),
('管理費', '本標的物大樓管理費及水電瓦斯費，雙方同意以交屋日為準，交屋日前由賣方負擔，交屋日後由買方負擔。', '一般'),
('現況交屋', '本案依現況交屋，買方已確認屋況並同意依現況承受，賣方不負瑕疵擔保責任（除重大瑕疵如海砂屋、輻射屋、凶宅外）。', '一般'),
('瑕疵擔保', '賣方保證本標的物無海砂屋、輻射屋、非自然身故（凶宅）及漏水等情事，若有不實，願負法律責任。', '一般'),
('履約保證', '本案買賣價金應存入履約保證專戶，待交屋結案後，由履約保證銀行依約撥付予賣方。', '一般'),
('稅費負擔', '本案買賣所需之土地增值稅由賣方負擔，契稅、印花稅、登記規費由買方負擔。房屋稅、地價稅以交屋日為基準日分算。', '一般'),
('違約責任', '若買方違約不買，已付價金由賣方沒收；若賣方違約不賣，應加倍退還所收價金予買方。', '一般'),
('其他特別約定', '本案成交總價含原屋況附贈之冷氣、熱水器、窗簾、燈具、廚具等固定設備。', '一般'),
('租約', '本標的物目前有租賃契約，買方同意承受原租賃契約（詳如附件），租金自交屋日起歸買方收取，押金由賣方移交予買方。', '一般'),
('頂樓加蓋', '本案頂樓加蓋部分（未保存登記建物），使用權利歸買方所有，惟其適法性由買方自行確認及承擔風險，賣方不負擔保責任。', '一般'),
('滲漏水', '針對主臥室窗框滲漏水情形，賣方承諾於交屋前修繕完畢，並提供修繕部分半年保固。', '一般'),
('壁癌', '針對客廳牆面壁癌情形，買方同意自行處理，賣方折讓價金新台幣0萬元整補貼修繕費用，且不負該部分瑕疵擔保責任。', '一般'),
('借屋裝修', '賣方同意於完稅款給付後、交屋前，借予買方進行室內裝修，惟買方應簽立「借屋裝修切結書」，並不得破壞主結構，相關水電管理費自借屋日起由買方負擔，若致買賣不成立，買方應負責回復原狀。', '一般'),
('提前交屋', '買賣雙方同意配合買方需求提前於民國114年月日辦理交屋，惟買方應先付清所有價款及完成相關手續。', '一般'),
('延後交屋', '因賣方搬遷不及，買賣雙方同意延後至於民國114年月日交屋，賣方同意按日支付買方延遲違約金或補貼租金。', '一般'),
('傢俱保留', '賣方同意保留現況傢俱（沙發、餐桌椅、床組）贈送予買方，不另收費。', '一般'),
('清潔', '賣方承諾於交屋前將屋內雜物清除並進行簡易清潔，維持可使用狀態。', '一般'),
('買方為指定登記名義人', '買方保留指定登記名義人之權利，惟應於簽約後0日內確認，並由指定人負連帶保證責任。', '一般'),
('共有人優先購買權拋棄', '賣方應於簽約後提供共有人拋棄優先購買權之證明文件，否則買方得解除契約。', '一般'),
('地役權', '本土地設定有地役權（供鄰地通行/排水等），買方已知悉並同意承受。', '一般'),
('法定空地', '本標的物包含法定空地比，買方不得隨意佔用或違建，應依公寓大廈管理條例規定使用。', '一般'),
('鑑界', '甲、乙雙方確已知悉，本案為一樓建物，永慶房屋於簽約前已詳盡告知甲方相關權益及風險，並建議於用印前向地政機關申請鑑界確認有無佔用、被佔用情事，經甲方審慎評估思考後表達不須申請並願依現況承購，日後雙方不得再就上述情事，向他方、永慶房屋及其受僱人為任何之請求。', '一般'),
('借屋裝修', '甲、乙雙方同意本買賣標的於依通常程序應於完稅款並地政士查無欠繳稅費送地政事務所辦理產權移轉登記(送件)後至交屋日前，乙方同意先將鑰匙交付甲方進行裝修，甲方同意開立與買賣總價尾款同額之本票，放置永慶房屋仲介股份有限公司承辦代書保管，作為尾款給付之擔保，並另簽立借屋裝修同意書，相關權利義務依借屋裝修同意書履行。', '一般'),
('預售屋', '甲、乙雙方確認，本買賣標的土地、主建物或本房屋登記總面積如與預售屋合約書標示有誤差時，雙方同意需互相找補，面積誤差之找補價款，找補價款依本買賣合約總價，比例方式依建商預售屋約定辦理，即分別以土地、主建物、附屬建物、共有部分價款，除以各該面積所得之單價(應扣除車位價款及面積)，找依本買賣合約書，並於交屋同時相互找補。', '一般'),
('預售屋', '本案停車位規格詳附預售屋買賣合約書，永慶房屋仲介股份有限公司已於簽約前詳盡告知甲方停車位相關權利義務，且乙方與永慶房屋仲介股份有限公司不保證所有車型皆可停放。甲方同意依預售屋買賣合約書規定承受，並同意不再就停車位相關事宜為任何主張。', '一般'),
('預售屋', '因乙方尚無法提供或未提供無違章建築證明，如日後主管機關核定屬違章建築部份即列入專案查報拆除，將影響使用現況或使用權益，甲方同意乙方無須提供前述文件並依同意現況格局承受。', '一般'),
('預售屋', '甲、乙雙方確認，乙方表示有與士林開發股份有限公司變更設備及工程(詳如附件)，上述變更費用已含在總價，雙方不另行補貼，甲方確已知悉並同意依約定承受。', '一般'),
('車位拆價', '雙方同意拆算本案地下一層車位編號91號車位價格為新台幣280萬元整、地下一層車位編號92號車位價格為新台幣280萬元整，並以前揭價格登載實價登錄。
', '一般'),
('外國人道路用地', '本案大同段二小段722-1地號為道路用地，依照外國人申請取得道路用地或綠地，應發文向建管處確認是否為建築基地，若為建築基地能併同移轉外國人(尚馬特、廖祐霆各半)，非為建築基地應移轉於本案中華民國籍登記人(廖祐霆)。
', '一般');
