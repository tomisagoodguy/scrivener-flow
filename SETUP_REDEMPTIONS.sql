-- Migration: Create bank_redemptions table
CREATE TABLE IF NOT EXISTS bank_redemptions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    bank_name TEXT,
    service_phone TEXT,
    account_info TEXT,
    lead_time TEXT,
    notes TEXT,
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    last_updated_by UUID
);

-- RLS Policies
ALTER TABLE bank_redemptions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Enable read access for all users" ON bank_redemptions
    FOR SELECT USING (auth.role() = 'authenticated');

CREATE POLICY "Enable insert access for all users" ON bank_redemptions
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Enable update access for all users" ON bank_redemptions
    FOR UPDATE USING (auth.role() = 'authenticated');

CREATE POLICY "Enable delete access for all users" ON bank_redemptions
    FOR DELETE USING (auth.role() = 'authenticated');

-- Trigger for updated_at
CREATE OR REPLACE FUNCTION update_redemptions_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_redemptions_updated_at
    BEFORE UPDATE ON bank_redemptions
    FOR EACH ROW
    EXECUTE FUNCTION update_redemptions_updated_at();

-- Bulk Insert Data
INSERT INTO bank_redemptions (bank_name, service_phone, account_info, lead_time, notes) VALUES
('兆豐', '', '兆豐銀行大安分行還款專戶
22991000013
備註姓名+id', '3日(不含撥款日第三天中午後)', ''),
('玉山', ':02-25681313', '', '3日(不含撥款日第三天中午後)', '要到分行填寫申請書'),
('滙豐', '66317171', '006909972003
?豐銀行還款專戶
匯豐銀行板橋分行', '3日(不含撥款日第三天中午後)', '金額當日提供
核對簽名'),
('星展', '66129889*2*0*#', '10000194688
星展銀行消費金融貸款專戶
星展銀行南京東路分行', '3日(含撥款日第三天中午後)', '備註:客戶姓名+身分證+結清'),
('富邦', '代書87521850
客戶87516665*5*3*2
8751-6665', '', '3日(含撥款日第三天中午後)', '營業部
備註:需填寫富邦授權書'),
('富壽', '2345-5111', '富邦敦南分行
富邦人壽保險股份有限公司
00737102001802', '3日(含撥款日第三天才會郵寄掛號', '郵寄給客戶'),
('華南', '分行電話', 'O', '3日(不含撥款日第三天中午後)', '申請書、委託書(要先到分行寫)'),
('新光', '', '', '3日(不含撥款日第三天中午後)', '要到分行填寫申請書'),
('台銀', '', '', '', '拿設定章跟授權書'),
('陽信', '', '', '3日(含撥款日第三天中午後)', ''),
('聯邦', '', '', '3日-5日(不含撥款日第三天中午後)', '借款章、身分證正本、委託書(無制式版本)'),
('安泰', '21731980*ID', '安泰銀行中崙分行', '撥款日隔天兩點過後至復興北路337號8樓*6272江小姐*6239高小姐', ''),
('國泰', '23110609*5810-', '帳務中心23110609*1、02-89797768
戶名:國泰世華商業銀行業務專戶
帳號001035599998
館前分行
領取地點:松山區南京東路四段16號9樓(北區授信作業中心)', '3日(含撥款日第三天上午能到作業中心領取)', '最新的身分證'),
('國壽', '客戶0800036599', '2570-2899#3658,3659,36533651/25702899*23713吳小姐北區授信作業中心02-23110609 
國泰世華銀行仁愛分行
國泰人壽保險股份有限公司', '4天', '02-25705677
世界服務中心:台北市松山區南京東路四段126號4樓'),
('台新', '87989999*31', '', '還款後打電話至內湖
本人領取:忠孝分行-3日(不含撥款日第三天中午後)
請客戶填寫改寄申請書傳真到指定地點(撥款隔天已限掛寄出)', ''),
('永豐', '分行電話', '', '3日(不含撥款日第三天中午後)', '本人領(最新的身分證)+委託書(簽名或蓋章2擇一)
(買方非本人)印鑑證明+身分證+權狀+委任書
(買方本人)身分證+權狀'),
('中信', '55599888*4343
02-27693408', '永吉分行', '第三天
t+2掛號寄出
台北市第四天上午會收到', '1.臨櫃領取:客戶指定分行+授權書(問金額時已傳給客戶，蓋開戶章+簽名)
2.郵寄撥款後第2個工作天掛號寄指定地址'),
('台新', '02-27787766*694*692*691照會
87989999*31清償開立', '台新國際商業銀行股份有限公司 
忠孝分行', '1日撥款後隔日可至舊宗路領取
2-3天(被繼承人印鑑證明+委任書+遺產稅完稅證明+除戶謄本或死亡證明+戶口名簿)', '02-82535088*529許
備註結清'),
('', '659', '', '', ''),
('中小企銀', '', '', '3日(不含撥款日第三天早上)', ''),
('遠東', '問金額8073-1166#4 照會 8251-6215#36962~36963', '戶名:遠東國際商業銀行板橋南雅分行', '第二天12:00後
可寄掛號', '帳號712+借款人身分證(A=01共14碼'),
('花旗', '2182-7301#9
(還款前三天申請)', '', '', '本人銷戶'),
('新光人壽', '', '新光人壽保險股份有限公司
新光城內分行', '忠孝西路一段66號39樓(新光三越樓上)', ''),
('新光', '作業中心
02-27215686*563', '', '3日(含撥款日第三天下午)', '無制式委託書+客戶授信章'),
('合庫', '', '', '3日(不含撥款日第三天中午後)', '制式委任書(簽名+蓋借款章)
借款人在海外1.海外授權需經外交部複印才能代理2.委任書寄回台灣'),
('基隆一信', '分行電話', '', '3日(含撥款日第三天早上)', '代書名片+便章+身分證影本'),
('陽信', '分行電話', '', '3日(含撥款日第三天中午後)', ''),
('華泰', '分行電話', '', '3日(不含撥款日第三天中午後)', '先寫委託書'),
('土銀', '分行電話', '', '', '要帶身份正本+借款章+委託書'),
('凱基', '02-80239077*1637游小姐', '', '指定分行3日(不含撥款第三天2:00後)
非指定到中和分行領(不撥款日第二天2:00後)', '制式申請書+委託書
需蓋借款章'),
('兆豐超過50年加強磚造無法承做', '', '', '', ''),
('台新', '小套1.63', '', '', ''),
('土銀', '總行制', '', '', ''),
('合庫', '貸85成合約書尾款須為85成才能送總行(3周)', '', '', ''),
('渣打', '4058-0088*1*39(ID)', '要請客戶授權照會', '', '通訊領取/指定分行領取'),
('中國信託', '0800024365;55599888#4343，帳務27680505-3665', '27603488', 'P', '第四天10:00
永吉路18號
借款章
簽名印章擇一對可'),
('王道', '客服0800801010', '', '還款隔日需再次電話客服申請塗銷文件', '3-5天掛號寄送'),
('', '40580088', '', '', ''),
('中華郵政', '23114331*7271*7273', '中華郵政股份有限公司-郵政劃撥儲金(7000010)
台北北門郵局壽險房貸劃撥專戶
19590181
備註:名+id', '2日(不含撥款日第二天下午後)', '北門郵局領取');