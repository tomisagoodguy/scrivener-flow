# Work Log - 2026-01-15

## Completed Tasks

1. **Rule Integration & Domain Expertise**:
    * Added `c:\Users\user\Documents\GitHub\scrivener-flow\.agent\domain_expertise.md` containing expert personas for Agentic AI, Next.js, TypeScript, etc., extracted from Antigravity Codes rules.
    * Updated `.agent/rules.md` to reference the new domain expertise and added a new "Data Integrity & Deduplication" rule.
2. **Todo System Refinement (Smart Agency Center)**:
    * **Future Stats**: Added real-time counts for "1 Day", "3 Days", and "7 Days" upcoming tasks in the header.
    * **Matrix View Optimization**: Simplified the matrix to only show "Urgent & Important" and "Important but Not Urgent" quadrants in a 2-column full-height layout.
    * **Calendar View Fix**: Implemented smart tooltip positioning to prevent overflow on the right edge (Friday/Saturday) of the calendar.
3. **Data Integrity Fixes**:
    * **Deduplication**: Implemented robust logic in `TodoContainer.tsx` to automatically detect and delete duplicate system tasks (Double Reminders) and legacy tasks missing `source_key`.
    * **Inspection Script**: Created `check_todos_duplicates.js` to verify database state.

## Mistakes & Lessons Learned (Self-Reflection)

### 1. Data Integrity & Deduplication (System Tasks)

* **Mistake**: System-generated tasks (e.g., Reminders from Cases) caused duplicate entries ("Double Reminders") because logic changes and legacy data co-existed without proper uniqueness enforcement.
* **Result**: User saw multiple reminders for the same event.
* **Lesson**:
  * **Identical Keys**: Use a composite key (e.g., `caseId_sourceKey`) to enforce uniqueness.
  * **Legacy Cleanup**: When fetching, ACTIVELY identify and delete legacy records (missing keys) or duplicates. DO NOT just filter them out from the UI; clean the database.
  * **Self-Correction**: Implement auto-healing logic in data fetching hooks.

### 2. UI Layout & Overflow

* **Mistake**: Calendar tooltips were restricted by container boundaries or screen edges on the right side.
* **Result**: Information was cut off.
* **Lesson**: Implement dynamic positioning logic (e.g., checking `day.getDay()`) to flip popover direction near screen edges.

### 3. Vibe & "Important" Definitions

* **Adjustment**: User clarified that "Urgent & Not Important" and "Not Urgent & Not Important" categories were unnecessary clutter.
* **Action**: Removed Q3/Q4 to focus the UI on high-impact tasks.
