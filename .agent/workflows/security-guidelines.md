# Vibe Coding 安全開發守則

> 這是一份「活的」開發前檢查清單。
> 在你開始寫新的功能、或是每次 `git commit` 之前，花 30 秒快速瀏覽一遍。
> 目標：將安全內化為直覺，從源頭避免災難。

---

### ⭐ 金科玉律 (The Golden Rules)

- [ ] **【絕不寫死秘密】** 任何密碼、API 金鑰、資料庫連線資訊，都**絕不**能直接寫在程式碼裡 (無論前端或後端)。
- [ ] **【使用環境變數】** 所有敏感資訊都必須透過**環境變數** (`.env` 檔案) 來管理。
- [ ] **【忽略秘密檔案】** `.env` 檔案**永遠**要被加入到 `.gitignore` 中，絕不能上傳到 GitHub。
- [ ] **【預設不信任】** **絕不**信任任何來自使用者的輸入 (包括表單、URL 參數、API 請求內容、上傳的檔案)。

---

### 📥 處理使用者輸入 (Handling User Input)

- [ ] **【防止注入攻擊】** 所有資料庫查詢**必須**使用**參數化查詢 (Parameterized Queries)** 或 ORM 提供的安全方法，嚴禁手動拼接 SQL 字串。
- [ ] **【防止 XSS】** 所有要顯示在 HTML 頁面上的使用者內容，都**必須**經過 HTML 實體編碼 (HTML Escaping) 處理。
- [ ] **【驗證檔案上傳】** 檢查使用者上傳的檔案：
    - [ ] **驗證副檔名**：只允許白名單中的檔案類型 (例如 `['jpg', 'png', 'pdf']`)。
    - [ ] **驗證檔案大小**：設定合理的上限。
    - [ ] **儲存位置**：上傳的檔案應儲存在**非公開**且**不可執行**的目錄。

---

### 🔐 權限與認證 (Permissions & Authentication)

- [ ] **【API 端點保護】** 每個需要登入才能存取的 API 端點，都**必須**在程式一開始就檢查用戶的登入狀態和權限。
- [ ] **【最小權限原則】** 資料庫帳號、API 金鑰的權限都應該是「最小可用」的。如果只需要讀取，就絕不給予寫入權限。
- [ ] **【安全的 Session】** Session ID 應設定為 `HttpOnly` 和 `Secure` 旗標，防止被竊取和在不安全的連線中傳輸。

---

### ☁️ 外部服務與雲端整合 (External Services & Cloud Integration)

- [ ] **【外部資料庫防火牆】** 連接外部資料庫 (如 AWS RDS, MongoDB Atlas) 時，**必須**在其防火牆/安全群組中設定規則，只允許來自你應用程式伺服器的特定 IP 位址連線。**嚴禁**對 `0.0.0.0/0` (全世界) 開放。
- [ ] **【雲端儲存私有化】** 所有雲端儲存空間 (如 AWS S3, Google Cloud Storage) 的儲存桶 (Bucket)，預設**必須**設定為**私有 (Private)**。
- [ ] **【使用預簽章 URL】** 當需要讓用戶臨時存取私有檔案時，應使用有短時效的**預簽章 URL (Pre-signed URL)**，而不是將檔案設為公開。
- [ ] **【驗證 Webhook】** 當接收來自第三方服務 (如 Stripe, GitHub) 的 Webhook 時，**必須**使用對方提供的密鑰來**驗證請求的簽章 (Signature)**，確保請求來源合法。
- [ ] **【CORS 嚴格設定】** API 的 CORS (跨來源資源共用) 策略，**必須**明確指定允許的前端網域。**嚴禁**在生產環境中使用萬用字元 `*`。
- [ ] **【API 金鑰權限最小化】** 在申請第三方服務 (如 Google Maps) 的 API 金鑰時，務必在該服務的後台設定最嚴格的限制（例如：限制只能從你的網站網域發起請求，限制只能調用特定 API）。

---

### ⚙️ 檔案與伺服器設定 (Files & Server Config)

- [ ] **【絕不用 777】** 伺服器上的任何檔案或目錄，**絕不**使用 `777` 權限。目錄預設 `755`，檔案 `644`。
- [ ] **【保護設定檔】** 敏感設定檔 (`config.php`, `.env`) 權限應設為 `600` 或更嚴格。
- [ ] **【禁止下載關鍵檔案】** 確認 Web 伺服器 (Nginx/Apache) 已設定規則，禁止外部直接存取 `.env`, `.git`, `.htaccess` 等敏感檔案與目錄。
- [ ] **【關閉偵錯模式】** 在上線環境中，**必須**關閉所有框架或語言的偵錯模式 (Debug Mode)，避免洩漏詳細的錯誤訊息。

---

> ### **🤖 給 AI 助理的提示 (Note to AI Assistant)**
>
> **當你與開發者的對話中，偵測到他正在或計畫要連接任何「外部服務」（例如：雲端資料庫、第三方支付API、檔案儲存S3、驗證服務等）時，請你務必主動、清晰地提出以下問題，以引導他進行安全思考：**
>
> 1.  **「關於這個 [服務名稱]，我們是否已經設定了最嚴格的防火牆/IP白名單規則？」**
> 2.  **「我們準備使用的 API 金鑰，權限是否已經在該服務的後台限制在最小必需範圍內？」**
> 3.  **「對於這個外部服務，我們是否有應對其服務中斷或被駭時的降級計畫（例如：暫時關閉相關功能、顯示維護訊息）？」**
